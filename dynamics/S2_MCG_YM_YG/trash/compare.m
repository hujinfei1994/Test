clear;clc;
%%
q = ones(7,1);
dq = 0.5*ones(7,1);
ddq = rand(7,1);

q1 = q(1);
q2 = q(2);
q3 = q(3);
q4 = q(4);
q5 = q(5);
q6 = q(6);
q7 = q(7);

qd1 = dq(1);
qd2 = dq(2);
qd3 = dq(3);
qd4 = dq(4);
qd5 = dq(5);
qd6 = dq(6);
qd7 = dq(7);

qdd1 = ddq(1);
qdd2 = ddq(2);
qdd3 = ddq(3);
qdd4 = ddq(4);
qdd5 = ddq(5);
qdd6 = ddq(6);
qdd7 = ddq(7);



%%
load T_flexiv.mat

%% 
betas = 0.5*ones(70,1);
betas(61) = 0;   %xx7  % XXR7=I7xx - I7yy;
betas(64) = 0;   %yy7
betas(62) = 0;   %xy7
betas(63) = 0;   %xz7
betas(65) = 0;   %yz7
betas(67) = 0;   %mx7
betas(68) = 0;   %my7


beta = T_37_by_70*betas;
L1=0.365;
L2=0.395;
L3=0.385;
L4=0.11;
L5=0.02;
g=-9.81;

cnt = 1;
beta1  = beta(cnt);cnt=cnt+1;
beta2  = beta(cnt);cnt=cnt+1;
beta3  = beta(cnt);cnt=cnt+1;
beta4  = beta(cnt);cnt=cnt+1;
beta5  = beta(cnt);cnt=cnt+1;
%beta6  = beta(cnt);cnt=cnt+1;
beta7  = beta(cnt);cnt=cnt+1;
beta8  = beta(cnt);cnt=cnt+1;
beta9  = beta(cnt);cnt=cnt+1;
beta10 = beta(cnt);cnt=cnt+1;
beta11 = beta(cnt);cnt=cnt+1;
%beta12 = beta(cnt);cnt=cnt+1;
beta13 = beta(cnt);cnt=cnt+1;
beta14 = beta(cnt);cnt=cnt+1;
beta15 = beta(cnt);cnt=cnt+1;
beta16 = beta(cnt);cnt=cnt+1;
beta17 = beta(cnt);cnt=cnt+1;
%beta18 = beta(cnt);cnt=cnt+1;
beta19 = beta(cnt);cnt=cnt+1;
beta20 = beta(cnt);cnt=cnt+1;
beta21 = beta(cnt);cnt=cnt+1;
beta22 = beta(cnt);cnt=cnt+1;
beta23 = beta(cnt);cnt=cnt+1;
%beta24 = beta(cnt);cnt=cnt+1;
beta25 = beta(cnt);cnt=cnt+1;
beta26 = beta(cnt);cnt=cnt+1;
beta27 = beta(cnt);cnt=cnt+1;
beta28 = beta(cnt);cnt=cnt+1;
beta29 = beta(cnt);cnt=cnt+1;
beta30 = beta(cnt);cnt=cnt+1;
beta31 = beta(cnt);cnt=cnt+1;
beta32 = beta(cnt);cnt=cnt+1;
beta33 = beta(cnt);cnt=cnt+1;
beta34 = beta(cnt);cnt=cnt+1;
beta35 = beta(cnt);cnt=cnt+1;
beta36 = beta(cnt);cnt=cnt+1;
%beta37 = beta(cnt);cnt=cnt+1;
beta38 = beta(cnt);cnt=cnt+1;
beta39 = beta(cnt);cnt=cnt+1;
beta40 = beta(cnt);cnt=cnt+1;
beta41 = beta(cnt);cnt=cnt+1;
beta42 = beta(cnt);%cnt=cnt+1;
%beta43 = beta(cnt);cnt=cnt+1;


%% inertia; mass center; mass
I1xx = betas(1); mx1 = betas(7);
I1xy = betas(2); my1 = betas(8);
I1xz = betas(3); mz1 = betas(9);
I1yy = betas(4); m1  = betas(10);
I1yz = betas(5);
I1zz = betas(6);

I2xx = betas(11); mx2 = betas(17);
I2xy = betas(12); my2 = betas(18);
I2xz = betas(13); mz2 = betas(19);
I2yy = betas(14); m2  = betas(20);
I2yz = betas(15);
I2zz = betas(16);

I3xx = betas(21); mx3 = betas(27);
I3xy = betas(22); my3 = betas(28);
I3xz = betas(23); mz3 = betas(29);
I3yy = betas(24);  m3 = betas(30);
I3yz = betas(25);
I3zz = betas(26);

I4xx = betas(31); mx4 = betas(37);
I4xy = betas(32); my4 = betas(38);
I4xz = betas(33); mz4 = betas(39);
I4yy = betas(34);  m4 = betas(40);
I4yz = betas(35);
I4zz = betas(36);

I5xx = betas(41); mx5 = betas(47);
I5xy = betas(42); my5 = betas(48);
I5xz = betas(43); mz5 = betas(49);
I5yy = betas(44);  m5 = betas(50);
I5yz = betas(45);
I5zz = betas(46);

I6xx = betas(51); mx6 = betas(57);
I6xy = betas(52); my6 = betas(58);
I6xz = betas(53); mz6 = betas(59);
I6yy = betas(54);  m6 = betas(60);
I6yz = betas(55);
I6zz = betas(56);

I7xx = betas(61); mx7 = betas(67);
I7xy = betas(62); my7 = betas(68);
I7xz = betas(63); mz7 = betas(69);
I7yy = betas(64);  m7 = betas(70);
I7yz = betas(65);
I7zz = betas(66);

%% regrouped paras // mapleÉú³É
t1 = cos(q2);
t2 = cos(q4);
t3 = cos(q5);
t4 = cos(q3);
t5 = sin(q3);
t6 = sin(q2);
t7 = t5 * qd1 * t6;
t8 = t4 * qd2;
t9 = -t8 + qd4 - t7;
t10 = sin(q5);
t11 = t4 * qd1 * t6 - qd2 * t5;
t12 = sin(q4);
t13 = t1 * qd1;
t14 = qd3 + t13;
t15 = t11 * t2 - t12 * t14;
t16 = t3 * t9;
t17 = t10 * t15;
t18 = t17 + qd6 - t16;
t19 = sin(q6);
t20 = t10 * t9 + t15 * t3;
t21 = cos(q6);
t22 = t2 * t14;
t23 = t12 * t11;
t24 = t22 + qd5 + t23;
t25 = t19 * t20 - t21 * t24;
t26 = qd1 * t6 * qd2;
t27 = t1 * qdd1;
t28 = -qdd3 + t26 - t27;
t29 = t6 * qdd1;
t13 = t13 * qd2;
t30 = t29 + t13;
t7 = t8 + t7;
t8 = t4 * t30;
t31 = t5 * qdd2;
t32 = -qd3 * t7 - t31 + t8;
t33 = t2 * t28;
t34 = t12 * t32;
t35 = t15 * qd4;
t36 = qdd5 + t35 + t34 - t33;
t22 = t22 + t23;
t23 = t2 * t32;
t37 = t12 * t28;
t38 = -qd4 * t22 + t23 + t37;
t39 = t4 * qdd2;
t40 = t5 * t30;
t41 = t11 * qd3;
t42 = qdd4 - t39 - t40 - t41;
t16 = -t17 + t16;
t17 = t3 * t38;
t43 = t10 * t42;
t44 = qd5 * t16 + t17 + t43;
t45 = qd6 + t18;
t46 = t21 * t44;
t47 = t19 * t36;
t48 = -t25 * t45 + t46 + t47;
t49 = t19 * t24;
t50 = t21 * t20;
t51 = t49 + t50;
t52 = t19 * t44;
t53 = t21 * t36;
t45 = t45 * t51 + t52 - t53;
t54 = t20 * t16;
t55 = qdd5 + t35 + t34 + t54 - t33;
t56 = t20 ^ 2;
t57 = t24 ^ 2;
t58 = -beta35 * t55 + beta36 * t48 + (t56 + t57) * beta41 - beta42 * t45;
t59 = t16 ^ 2;
t35 = qdd5 + t35 + t34 - t54 - t33;
t60 = t51 ^ 2;
t61 = t18 ^ 2;
t62 = t3 * t42;
t63 = t10 * t38;
t64 = t20 * qd5;
t65 = t25 * t51;
t66 = -t62 + qdd6 + t63 + t64 - t65;
t67 = (t61 + t60) * beta36 + t66 * beta42;
t68 = -t62 + qdd6 + t63 + t64 + t65;
t69 = t25 ^ 2;
t70 = beta36 * t68 - (t61 + t69) * beta42;
t71 = (t57 + t59) * beta35 + t35 * beta41 - t19 * t67 + t21 * t70;
t72 = t3 * t58;
t73 = t71 * t10;
t74 = t73 + t72;
t75 = t11 * t7;
t76 = -qdd3 + t75 + t26 - t27;
t29 = t29 + 0.2e1 * t13;
t77 = qd1 ^ 2;
t78 = t77 * t6 * t1;
t79 = qdd2 - t78;
t80 = L2 * t79 + g * t6;
t81 = t5 * t80;
t82 = t4 * L2 * t29;
t83 = L5 * t76 - t81 + t82;
t84 = qd4 + t9;
t85 = -t22 * t84 + t23 + t37;
t84 = t15 * t84 - t33 + t34;
t86 = L3 * t85 + (t76 + t84) * L5 - t81 + t82;
t87 = t15 * t22;
t88 = qdd4 - t39 - t40 - t41 + t87;
t89 = t9 ^ 2;
t90 = t22 ^ 2;
t91 = t89 + t90;
t92 = t7 ^ 2;
t93 = t14 ^ 2;
t94 = t92 + t93;
t80 = t4 * t80;
t95 = t5 * L2 * t29;
t96 = L5 * t94 + t80 + t95;
t97 = qd3 + t14;
t98 = t11 * t97 + t39 + t40;
t99 = qd2 ^ 2;
t100 = t6 ^ 2;
t101 = t77 * t100;
t102 = L2 * (t101 + t99);
t103 = t1 * g;
t104 = L5 * t98 - t102 - t103;
t105 = t2 * t96;
t106 = t12 * t104;
t107 = L3 * t88 + L5 * t91 - t105 - t106;
t108 = t10 * t107 + t3 * t86;
t109 = beta31 * (-qd6 * t25 + qdd7 + t46 + t47);
t45 = beta11 * t45 - (t61 - t69) * beta17 - beta23 * t66 + beta36 * t108 + t109 + t18 * t25 * (beta5 - beta30);
t66 = cos(q7);
t110 = sin(q7);
t111 = t110 * t25 + t18 * t66;
t112 = -t110 * t18 + t25 * t66;
t49 = (qd7 + t49 + t50) * beta31;
t48 = beta11 * t48 - beta17 * t68 + (t61 - t60) * beta23 - beta42 * t108 + beta5 * (qd6 * t51 + t52 - t53) + t18 * t51 * beta30 + t49 * (t110 * t112 - t111 * t66);
t50 = -t10 * t86 + t107 * t3;
t61 = -qd5 + t24;
t68 = t15 ^ 2;
t54 = t54 * beta4;
t86 = t19 * t45;
t107 = t48 * t21;
t113 = t50 * beta41;
t108 = t108 * beta35;
t114 = (t56 - t59) * beta10;
t115 = beta22 * (t20 * t61 + t62 - t63);
t61 = beta16 * (-t16 * t61 + t17 + t43);
t36 = beta29 * t36;
t116 = -L5 * t74 - (t68 - t89) * beta15 + beta21 * t88 + beta34 * t83 + beta9 * t85 + t54 - t86 + t107 + t113 + t108 - t114 - t115 - t61 - t36 + t9 * t15 * (beta3 - beta28);
t117 = t84 * beta34;
t85 = t85 * beta40;
t118 = t68 + t89;
t41 = qdd4 - t39 - t40 - t41 - t87;
t104 = t2 * t104;
t96 = t12 * t96;
t119 = L3 * t118 - L5 * t41 - t104 + t96;
t120 = qd5 + t24;
t121 = -t120 * t20 + t62 - t63;
t44 = beta10 * t121 + beta16 * t55 - (t57 - t59) * beta22 + beta4 * t44 - beta41 * t119 + t19 * t48 + t21 * t45 + t24 * t16 * beta29;
t18 = -qd6 + t18;
t16 = t120 * t16 + t17 + t43;
t17 = (t119 * t21 + t19 * t50) * beta42;
t43 = (t119 * t19 - t21 * t50) * beta36;
t45 = (-t69 + t60) * beta11;
t25 = beta23 * (t18 * t25 + t46 + t47);
t18 = beta17 * (t18 * t51 - t52 + t53);
t46 = beta30 * (-t62 + qdd6 + t63 + t64);
t47 = t49 * (t110 * t111 + t112 * t66);
t48 = t65 * beta5;
t20 = beta10 * t16 - (t56 - t57) * beta16 + beta22 * t35 + beta35 * t119 - t17 - t43 + t45 + t25 - t18 - t46 - t47 + t48 + t24 * t20 * (beta4 - beta29);
t24 = -L3 * t74 - beta15 * t41 - (-t89 + t90) * beta21 - beta3 * t38 + beta40 * t83 + beta9 * t84 + t10 * t20 - t3 * t44 + t9 * t22 * beta28;
t35 = t11 ^ 2;
t38 = qd3 - t14;
t49 = t24 * t12;
t50 = (t95 + t80) * beta39;
t51 = (t81 - t82) * beta33;
t52 = (t35 - t92) * beta8;
t39 = beta20 * (t11 * t38 + t39 + t40);
t38 = beta14 * (-t38 * t7 - t31 + t8);
t28 = beta27 * t28;
t40 = t75 * beta2;
t53 = (t73 + t72 - t117 - t85) * L5;
t55 = t2 * t116;
t56 = t102 + t103;
t24 = beta14 * t76 - beta2 * t32 - (t92 - t93) * beta20 + beta39 * t56 + beta8 * t98 + t116 * t12 + t2 * t24 + t14 * t7 * beta27;
t32 = beta33 * t76 + (t35 + t93) * beta39 - t117 + t72 + t73 - t85;
t57 = -qdd3 - t75 + t26 - t27;
t59 = t3 * t71;
t58 = t58 * t10;
t60 = beta34 * t91 + beta40 * t88 - t58 + t59;
t62 = t121 * beta35;
t16 = t16 * beta41;
t19 = t19 * t70;
t21 = t67 * t21;
t41 = beta34 * t41 - beta40 * t118 - t16 + t19 + t21 + t62;
t63 = beta33 * t94 - beta39 * t57 + t12 * t41 + t2 * t60;
t16 = t62 - t16 + t19 + t21;
t9 = -qd4 + t9;
t3 = t3 * t20;
t19 = t87 * beta3;
t20 = (-t58 + t59) * L3;
t10 = t44 * t10;
t21 = (t106 + t105) * beta40;
t44 = (t104 - t96) * beta34;
t58 = (t68 - t90) * beta9;
t15 = beta21 * (t9 * t15 + t33 - t34);
t9 = beta15 * (t9 * t22 + t23 + t37);
t22 = beta28 * t42;
t2 = (t12 * t60 - t2 * t41 + t16) * L5 + (t35 - t93) * beta14 + beta20 * t57 - beta33 * t56 + beta8 * (t7 * t97 + t31 - t8) - t3 - t19 + t20 - t10 - t21 + t44 - t58 - t15 - t9 - t22 - t14 * t11 * (beta2 - beta27);
t7 = t1 ^ 2;
tau = [beta25 * qdd1 + t1 * ((-t101 + t99) * beta13 + beta19 * t79 + beta7 * t29 + t49 + t50 + t51 + t52 - t39 + t38 - t28 + t40 - t53 - t55 + t26 * (beta1 - beta26)) + t6 * ((t32 * t4 + t5 * t63) * L2 + beta1 * t30 + beta13 * (qdd2 + t78) - (-t7 * t77 + t99) * beta19 - beta7 * (0.2e1 * t26 - t27) - t24 * t4 + t5 * t2 + t13 * beta26) (-t32 * t5 + t4 * t63) * L2 + beta26 * qdd2 + t77 * (-t7 + t100) * beta7 + (-beta32 * t1 + beta38 * t6) * g + (beta13 * t6 + beta19 * t1) * qdd1 + t2 * t4 + t24 * t5 - t78 * beta1 -t28 + t49 + t50 + t51 + t40 - t53 - t55 + t52 - t39 + t38 -L5 * t16 + t10 + t15 + t19 - t20 + t21 + t22 + t3 - t44 + t58 + t9 -t54 + t36 - t108 + t114 + t115 + t61 - t107 - t113 + t86 t47 - t25 + t18 + t46 - t48 + t17 + t43 - t45 t109];


%% original parameters
S2=sin(q2);
C2=cos(q2);
S3=sin(q3);
C3=cos(q3);
S4=sin(q4);
C4=cos(q4);
S5=sin(q5);
C5=cos(q5);
S6=cos(q6);
C6=-sin(q6);
S7=sin(q7);
C7=cos(q7);
No31=I1zz*qdd1;
WI12=qd1*S2;
WI22=C2*qd1;
WP12=qdd1*S2 + qd2*WI22;
WP22=C2*qdd1 - qd2*WI12;
DV112=-(WI12*WI12);
DV222=-(WI22*WI22);
DV332=-(qd2*qd2);
DV122=WI12*WI22;
DV132=qd2*WI12;
DV232=qd2*WI22;
U122=DV122 - qdd2;
U132=DV132 + WP22;
U212=DV122 + qdd2;
U222=DV112 + DV332;
U232=DV232 - WP12;
U312=DV132 - WP22;
U322=DV232 + WP12;
VP12=-(g*S2);
VP22=-(C2*g);
PIS12=-I2yy + I2zz;
PIS22=I2xx - I2zz;
PIS32=-I2xx + I2yy;
No12=(-DV222 + DV332)*I2yz + DV232*PIS12 + I2xz*U212 - I2xy*U312 + I2xx*WP12;
No22=(DV112 - DV332)*I2xz + DV132*PIS22 - I2yz*U122 + I2xy*U322 + I2yy*WP22;
No32=(-DV112 + DV222)*I2xy + DV122*PIS32 + I2zz*qdd2 + I2yz*U132 - I2xz*U232;
WI13=-(qd2*S3) + C3*WI12;
WI23=-(C3*qd2) - S3*WI12;
W33=qd3 + WI22;
WP13=-(qdd2*S3) + qd3*WI23 + C3*WP12;
WP23=-(C3*qdd2) - qd3*WI13 - S3*WP12;
WP33=qdd3 + WP22;
DV113=-(WI13*WI13);
DV223=-(WI23*WI23);
DV333=-(W33*W33);
DV123=WI13*WI23;
DV133=W33*WI13;
DV233=W33*WI23;
U113=DV223 + DV333;
U123=DV123 - WP33;
U133=DV133 + WP23;
U213=DV123 + WP33;
U223=DV113 + DV333;
U233=DV233 - WP13;
U313=DV133 - WP23;
U323=DV233 + WP13;
VSP13=L2*U122 + VP12;
VSP23=L2*U222 + VP22;
VSP33=L2*U322;
VP13=C3*VSP13 - S3*VSP33;
VP23=-(S3*VSP13) - C3*VSP33;
F13=mx3*U113 + my3*U123 + mz3*U133 + m3*VP13;
F23=mx3*U213 + my3*U223 + mz3*U233 + m3*VP23;
PIS13=-I3yy + I3zz;
PIS23=I3xx - I3zz;
PIS33=-I3xx + I3yy;
No13=(-DV223 + DV333)*I3yz + DV233*PIS13 + I3xz*U213 - I3xy*U313 + I3xx*WP13;
No23=(DV113 - DV333)*I3xz + DV133*PIS23 - I3yz*U123 + I3xy*U323 + I3yy*WP23;
No33=(-DV113 + DV223)*I3xy + DV123*PIS33 + I3yz*U133 - I3xz*U233 + I3zz*WP33;
WI14=-(S4*W33) + C4*WI13;
WI24=-(C4*W33) - S4*WI13;
W34=qd4 + WI23;
WP14=qd4*WI24 + C4*WP13 - S4*WP33;
WP24=-(qd4*WI14) - S4*WP13 - C4*WP33;
WP34=qdd4 + WP23;
DV114=-(WI14*WI14);
DV224=-(WI24*WI24);
DV334=-(W34*W34);
DV124=WI14*WI24;
DV134=W34*WI14;
DV234=W34*WI24;
U114=DV224 + DV334;
U124=DV124 - WP34;
U134=DV134 + WP24;
U214=DV124 + WP34;
U224=DV114 + DV334;
U234=DV234 - WP14;
U314=DV134 - WP24;
U324=DV234 + WP14;
U334=DV114 + DV224;
VSP14=L5*U113 + VP13;
VSP24=L5*U213 + VP23;
VSP34=L5*U313 + VSP23;
VP14=C4*VSP14 - S4*VSP34;
VP24=-(S4*VSP14) - C4*VSP34;
F14=mx4*U114 + my4*U124 + mz4*U134 + m4*VP14;
F24=mx4*U214 + my4*U224 + mz4*U234 + m4*VP24;
F34=mx4*U314 + my4*U324 + mz4*U334 + m4*VSP24;
PIS14=-I4yy + I4zz;
PIS24=I4xx - I4zz;
PIS34=-I4xx + I4yy;
No14=(-DV224 + DV334)*I4yz + DV234*PIS14 + I4xz*U214 - I4xy*U314 + I4xx*WP14;
No24=(DV114 - DV334)*I4xz + DV134*PIS24 - I4yz*U124 + I4xy*U324 + I4yy*WP24;
No34=(-DV114 + DV224)*I4xy + DV124*PIS34 + I4yz*U134 - I4xz*U234 + I4zz*WP34;
WI15=S5*W34 + C5*WI14;
WI25=C5*W34 - S5*WI14;
W35=qd5 - WI24;
WP15=qd5*WI25 + C5*WP14 + S5*WP34;
WP25=-(qd5*WI15) - S5*WP14 + C5*WP34;
WP35=qdd5 - WP24;
DV115=-(WI15*WI15);
DV225=-(WI25*WI25);
DV335=-(W35*W35);
DV125=WI15*WI25;
DV135=W35*WI15;
DV235=W35*WI25;
U115=DV225 + DV335;
U125=DV125 - WP35;
U135=DV135 + WP25;
U215=DV125 + WP35;
U225=DV115 + DV335;
U235=DV235 - WP15;
U315=DV135 - WP25;
U325=DV235 + WP15;
U335=DV115 + DV225;
VSP15=-(L5*U114) - L3*U124 + VP14;
VSP25=-(L5*U214) - L3*U224 + VP24;
VSP35=-(L5*U314) - L3*U324 + VSP24;
VP15=C5*VSP15 + S5*VSP35;
VP25=-(S5*VSP15) + C5*VSP35;
F15=mx5*U115 + my5*U125 + mz5*U135 + m5*VP15;
F25=mx5*U215 + my5*U225 + mz5*U235 + m5*VP25;
F35=mx5*U315 + my5*U325 + mz5*U335 - m5*VSP25;
PIS15=-I5yy + I5zz;
PIS25=I5xx - I5zz;
PIS35=-I5xx + I5yy;
No15=(-DV225 + DV335)*I5yz + DV235*PIS15 + I5xz*U215 - I5xy*U315 + I5xx*WP15;
No25=(DV115 - DV335)*I5xz + DV135*PIS25 - I5yz*U125 + I5xy*U325 + I5yy*WP25;
No35=(-DV115 + DV225)*I5xy + DV125*PIS35 + I5yz*U135 - I5xz*U235 + I5zz*WP35;
WI16=S6*W35 + C6*WI15;
WI26=C6*W35 - S6*WI15;
W36=qd6 - WI25;
WP16=qd6*WI26 + C6*WP15 + S6*WP35;
WP26=-(qd6*WI16) - S6*WP15 + C6*WP35;
WP36=qdd6 - WP25;
DV116=-(WI16*WI16);
DV226=-(WI26*WI26);
DV336=-(W36*W36);
DV126=WI16*WI26;
DV136=W36*WI16;
DV236=W36*WI26;
U116=DV226 + DV336;
U126=DV126 - WP36;
U136=DV136 + WP26;
U216=DV126 + WP36;
U226=DV116 + DV336;
U236=DV236 - WP16;
U316=DV136 - WP26;
U326=DV236 + WP16;
U336=DV116 + DV226;
VP16=C6*VP15 - S6*VSP25;
VP26=-(S6*VP15) - C6*VSP25;
F16=mx6*U116 + my6*U126 + mz6*U136 + m6*VP16;
F26=mx6*U216 + my6*U226 + mz6*U236 + m6*VP26;
F36=mx6*U316 + my6*U326 + mz6*U336 - m6*VP25;
PIS16=-I6yy + I6zz;
PIS26=I6xx - I6zz;
PIS36=-I6xx + I6yy;
No16=(-DV226 + DV336)*I6yz + DV236*PIS16 + I6xz*U216 - I6xy*U316 + I6xx*WP16;
No26=(DV116 - DV336)*I6xz + DV136*PIS26 - I6yz*U126 + I6xy*U326 + I6yy*WP26;
No36=(-DV116 + DV226)*I6xy + DV126*PIS36 + I6yz*U136 - I6xz*U236 + I6zz*WP36;
WI17=S7*W36 + C7*WI16;
WI27=C7*W36 - S7*WI16;
W37=qd7 - WI26;
WP17=qd7*WI27 + C7*WP16 + S7*WP36;
WP27=-(qd7*WI17) - S7*WP16 + C7*WP36;
WP37=qdd7 - WP26;
DV117=-(WI17*WI17);
DV227=-(WI27*WI27);
DV337=-(W37*W37);
DV127=WI17*WI27;
DV137=W37*WI17;
DV237=W37*WI27;
U117=DV227 + DV337;
U127=DV127 - WP37;
U137=DV137 + WP27;
U217=DV127 + WP37;
U227=DV117 + DV337;
U237=DV237 - WP17;
U317=DV137 - WP27;
U327=DV237 + WP17;
U337=DV117 + DV227;
VSP17=L4*U116 + VP16;
VSP27=L4*U216 + VP26;
VSP37=L4*U316 - VP25;
VP17=C7*VSP17 + S7*VSP37;
VP27=-(S7*VSP17) + C7*VSP37;
F17=mx7*U117 + my7*U127 + mz7*U137 + m7*VP17;
F27=mx7*U217 + my7*U227 + mz7*U237 + m7*VP27;
F37=mx7*U317 + my7*U327 + mz7*U337 - m7*VSP27;
PIS17=-I7yy + I7zz;
PIS27=I7xx - I7zz;
PIS37=-I7xx + I7yy;
No17=(-DV227 + DV337)*I7yz + DV237*PIS17 + I7xz*U217 - I7xy*U317 + I7xx*WP17;
No27=(DV117 - DV337)*I7xz + DV137*PIS27 - I7yz*U127 + I7xy*U327 + I7yy*WP27;
No37=(-DV117 + DV227)*I7xy + DV127*PIS37 + I7yz*U137 - I7xz*U237 + I7zz*WP37;
N17=No17 - mz7*VP27 - my7*VSP27;
N27=No27 + mz7*VP17 + mx7*VSP27;
N37=No37 - my7*VP17 + mx7*VP27;
FDI17=C7*F17 - F27*S7;
FDI37=C7*F27 + F17*S7;
E16=F16 + FDI17;
E26=F26 - F37;
E36=F36 + FDI37;
N16=C7*N17 + No16 - N27*S7 - my6*VP25 - mz6*VP26;
N26=-(FDI37*L4) - N37 + No26 + mz6*VP16 + mx6*VP25;
N36=-(F37*L4) + C7*N27 + No36 + N17*S7 - my6*VP16 + mx6*VP26;
FDI16=C6*E16 - E26*S6;
FDI36=C6*E26 + E16*S6;
E15=F15 + FDI16;
E25=-E36 + F25;
E35=F35 + FDI36;
N15=C6*N16 + No15 - N26*S6 - mz5*VP25 - my5*VSP25;
N25=-N36 + No25 + mz5*VP15 + mx5*VSP25;
N35=C6*N26 + No35 + N16*S6 - my5*VP15 + mx5*VP25;
FDI15=C5*E15 - E25*S5;
FDI35=C5*E25 + E15*S5;
E14=F14 + FDI15;
E24=-E35 + F24;
E34=F34 + FDI35;
N14=-(FDI35*L3) + C5*N15 + No14 - N25*S5 - mz4*VP24 + my4*VSP24;
N24=FDI35*L5 - N35 + No24 + mz4*VP14 - mx4*VSP24;
N34=FDI15*L3 + E35*L5 + C5*N25 + No34 + N15*S5 - my4*VP14 + mx4*VP24;
FDI14=C4*E14 - E24*S4;
FDI34=-(C4*E24) - E14*S4;
E13=F13 + FDI14;
E23=E34 + F23;
N13=C4*N14 + No13 - N24*S4 - mz3*VP23 + my3*VSP23;
N23=-(FDI34*L5) + N34 + No23 + mz3*VP13 - mx3*VSP23;
N33=E34*L5 - C4*N24 + No33 - N14*S4 - my3*VP13 + mx3*VP23;
FDI13=C3*E13 - E23*S3;
FDI33=-(C3*E23) - E13*S3;
N12=FDI33*L2 + C3*N13 + No12 - N23*S3 - mz2*VP22;
N22=N33 + No22 + mz2*VP12;
N32=-(FDI13*L2) - C3*N23 + No32 - N13*S3 - my2*VP12 + mx2*VP22;
N31=C2*N22 + No31 + N12*S2;
GAM1=N31;
GAM2=N32;
GAM3=N33;
GAM4=N34;
GAM5=N35;
GAM6=N36;
GAM7=N37;
tau_s(1)=GAM1;
tau_s(2)=GAM2;
tau_s(3)=GAM3;
tau_s(4)=GAM4;
tau_s(5)=GAM5;
tau_s(6)=GAM6;
tau_s(7)=GAM7;


tau-tau_s










